### Version 1.5
  $vcHosts = @(
        "vcenter01",
        "vcenter02",
        "vcenter03"
        );

ForEach ($vc in $vcHosts) {

    Get-VICredentialStoreItem -Host $vc
    Connect-VIServer $vc 





# Obtain a list of VMs in the Cluster and sort them by name

        [Array]$vmList = @( Get-VM | Sort Name );

      $results = foreach ( $vmItem in $vmList )
           {
   # Get the Snapshot information of every VM in #vmList

   [Array] $vmSnapshotList = @( Get-Snapshot -VM $vmItem )     

   # Now we need to select what to see

  foreach ( $snapshotItem in $vmSnapshotList )
          {
     # I need everything rounded up in GB so it makes sense

        $vmProvisionedSpaceGB = [Math]::Round( $vmItem.ProvisionedSpaceGB, 2 );
        $vmUsedSpaceGB        = [Math]::Round( $vmItem.UsedSpaceGB,        2 );
        $snapshotSizeGB       = [Math]::Round( $snapshotItem.SizeGB,       2 );
        $snapshotAgeDays      = ((Get-Date) - $snapshotItem.Created).Days;
        $snapevent = Get-VIEvent -Entity $snapshotItem.VM -Types Info -Finish $snapshotItem.Created -MaxSamples 1 | Where-Object {$_.FullFormattedMessage -imatch "Task: Create virtual machine snapshot"};

        $output = New-Object -TypeName PSObject;

        $output | Add-Member -MemberType NoteProperty -Name "VM"                 -Value $vmItem;
        $output | Add-Member -MemberType NoteProperty -Name "Name"               -Value $snapshotItem.Name;
        $output | Add-Member -MemberType NoteProperty -Name "Description"        -Value $snapshotItem.Description;
        $output | Add-Member -MemberType NoteProperty -Name "Created"            -Value $snapshotItem.Created;
        $output | Add-Member -MemberType NoteProperty -Name "Created by" -Value $snapevent.UserName;
        $output | Add-Member -MemberType NoteProperty -Name "Number of Days Active"            -Value $snapshotAgeDays;
        $output | Add-Member -MemberType NoteProperty -Name "Parent Snapshot"     -Value $snapshotItem.ParentSnapshot.Name;
        $output | Add-Member -MemberType NoteProperty -Name "Is this the Current Snapshot?"  -Value $snapshotItem.IsCurrent;
        $output | Add-Member -MemberType NoteProperty -Name "Snapshot Size in GB"     -Value $snapshotSizeGB;
        $output | Add-Member -MemberType NoteProperty -Name "Provisioned Space in GB" -Value $vmProvisionedSpaceGB;
        $output | Add-Member -MemberType NoteProperty -Name "Used Space in GB"        -Value $vmUsedSpaceGB;
       # $output | Add-Member -MemberType NoteProperty -Name "Snapshot Location" -Value $snapshotItem.ExtensionData.Snapshot;
        

        $output;
    } 
}   

$results | Export-Csv -Path "C:\Scripts\Salidas\$((Get-Date).ToString("yyyyMMdd_HHmmss"))_Snaphot_$vc.csv" -NoTypeInformation 

}
